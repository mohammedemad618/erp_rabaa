# تقرير تقييم تجربة المستخدم (UX) — Enterprise Travel ERP

**تاريخ التقييم:** 26 فبراير 2025  
**طريقة التقييم:** تصفح كامل عبر المتصفح (EN/AR) + مراجعة الكود كمختبر أنظمة

---

## 1. ملخص تنفيذي

| المعيار | التقييم | ملاحظة مختصرة |
|---------|---------|----------------|
| **التنقل والوصولية** | جيد | جميع الصفحات الرئيسية تعمل، Breadcrumb و sidebar واضحان |
| **الاتساق البصري** | جيد | تصميم موحد، ألوان وحالات واضحة |
| **دعم RTL واللغة العربية** | جيد مع ملاحظات | `dir` و`lang` مضبوطان، نصوص هاردكود في أماكن |
| **النماذج والتفاعل** | جيد | تسجيل الدخول واضح، تحقق من الأخطاء موجود |
| **تحميل وأخطاء** | يحتاج تحسين | لا يوجد loading/error boundaries أو هيكل 404 موحد |
| **إمكانية الوصول (a11y)** | متوسط | بعض aria، نقص في تسميات وتركيز لوحة المفاتيح |

---

## 2. ما تم التحقق منه عبر المتصفح

- **الصفحات المختبرة:** `/en`, `/en/services`, `/en/operations`, `/en/crm`, `/en/accounting`, `/en/treasury`, `/en/reports`, `/en/settings`, `/en/login`, `/ar`, `/ar/services`
- **النتيجة:** جميع المسارات تستجيب بدون أخطاء؛ `/en/login` يعيد التوجيه إلى `/en` عند وجود جلسة (سلوك صحيح).
- **العنوان:** موحّد "Rabea Al Ahlam | Enterprise Travel ERP" لجميع الصفحات — لا تمييز في عنوان التبويب حسب الصفحة (قد يقلل التمييز عند فتح تبويبات متعددة).

---

## 3. نقاط القوة

1. **هيكل تنقل واضح**
   - Sidebar مقسّم إلى أقسام (Main, Operations, Customers, Finance, Tools).
   - Breadcrumb يعكس القسم الحالي.
   - طبقية الصفحات (Dashboard → Services → خدمات فرعية) منطقية.

2. **دعم ثنائي اللغة و RTL**
   - `layout.tsx`: `dir={locale === "ar" ? "rtl" : "ltr"}`, `lang={locale}`, و`font-ar` للعربية.
   - مبدّل اللغة موجود في الهيدر.

3. **تجربة تسجيل الدخول**
   - حسابات تجريبية قابلة للنقر لملء الحقول.
   - رسالة خطأ واضحة واهتزاز عند الفشل.
   - حالة تحميل (Signing in… / جاري الدخول...).

4. **واجهات البيانات**
   - جداول مع عناوين وفلترة وبحث (مثل Operations و Services).
   - مؤشرات KPI وروابط سريعة من لوحة التحكم.

5. **صلاحيات**
   - عناصر القائمة تظهر حسب الصلاحيات؛ إعادة توجيه للـ login عند عدم المصادقة.

---

## 4. المشاكل والملاحظات (كمجرب أنظمة)

### 4.1 تجربة التنقل والصفحات

- **عنوان الصفحة (title) ثابت:** لا يتغير مع المسار (مثلاً "Dashboard | …" أو "Operations | …"). يقلل التمييز عند التبويبات المتعددة والمرجعية.
- **عدم وجود صفحات loading/error:** لا يوجد `loading.tsx` أو `error.tsx` في المسارات — لا مؤشر تحميل موحّد ولا معالجة أخطاء واجهة عند فشل تحميل صفحة.
- **404 و not-found:** استخدام `notFound()` في الـ locale غير الصحيح موجود، لكن لا يظهر هيكل واجهة موحد لصفحة "الصفحة غير موجودة" (إن لم يكن هناك `not-found.tsx`).

### 4.2 النصوص والترجمة

- **نصوص هاردكود في الواجهة:**
  - `app-shell.tsx`: "إدارة الخدمات" / "Manage Services" و "العملاء" / "Customers" معتمد على `locale === "ar"` بدل المفاتيح من `next-intl`.
  - `dashboard`: "نشط" / "active" مكتوب يدوياً.
  - `services-hub`: عناوين وأوصاف الصفحة بالعربي/إنجليزي مباشرة بدل الترجمات.
- **النتيجة:** صعوبة في الصيانة وعدم استغلال ملفات الترجمة بالكامل.

### 4.3 النماذج والإدخال

- **تسجيل الدخول:** جيد من حيث الوضوح والتحقق؛ عرض كلمة المرور في أزرار الحسابات التجريبية قد يكون مربكاً من ناحية أمان الإدراك (رغم أنها تجريبية).
- **حقول البحث والفلترة:**
  - في Services: حقل البحث بدون `label` مرئي أو `aria-label`؛ الاعتماد على placeholder فقط قد يقلل إمكانية الوصول.
  - في Operations: نفس الفكرة إن وُجدت حقول بحث بدون تسميات.

### 4.4 إمكانية الوصول (Accessibility)

- **ما وُجد:**
  - `FormField`: دعم `aria-invalid`, `aria-describedby`, و`role="alert"` للأخطاء.
  - جدول العمليات: `aria-label` للجدول.
  - مركز الإشعارات: `aria-label="Notifications"`.
- **ما ينقص:**
  - أزرار الـ sidebar (Collapse/Expand، القائمة على الموبايل) بدون نصوص بديلة أو `aria-label` واضح في كل الحالات.
  - عدم التأكد من ترتيب التبويب (focus order) وعدم وجود مصائد تركيز في النوافذ المنزلقة/الـ panels.
  - ألوان الحالات (مثل الـ status pills) معتمدة على اللون فقط؛ لا رموز أو نص بديل مضمون لضعاف البصر.

### 4.5 الهاتف والاستجابة

- Sidebar يتحول إلى قائمة منزلقة على الموبايل مع زر القائمة وطبقة خلفية — إيجابي.
- لا يمكن التأكد من حجم الخطوط واللمس (touch targets) دون فحص فعلي على أجهزة؛ يُفضّل التأكد أن الأزرار والروابط لا تقل عن ~44px في البعد الأصغر.

### 4.6 الأداء والإدراك

- لا توجد هيكلة واضحة لـ Suspense أو loading states داخل الصفحات (مثلاً للجداول أو الـ KPI)، ما قد يترك واجهة "فارغة" لحظات عند بطء البيانات.

### 4.7 أمان الإدراك والأمان

- عرض كلمات مرور الحسابات التجريبية في الواجهة قد يوهم بأن النظام يعرض كلمات المرور؛ إضافة تنبيه "Demo only" أو إخفاء كلمة المرور مع زر "Use this account" يقلل اللبس.

---

## 5. التوصيات ذات الأولوية

1. **عناوين ديناميكية للصفحات:** استخدام `generateMetadata` أو `metadata` في كل صفحة (أو layout) لتعيين `title` و`description` حسب المسار واللغة.
2. **إضافة `loading.tsx` و `error.tsx`:** على مستوى `[locale]` أو الصفحات الثقيلة لتحميل موحّد ومعالجة أخطاء واضحة.
3. **استبدال النصوص الهاردكود بترجمات:** نقل "Manage Services", "Customers", "نشط/active", وعناوين/أوصاف Services Hub إلى ملفات next-intl واستخدام `useTranslations`/`getTranslations`.
4. **تحسين a11y:** إضافة `aria-label` لأزرار الـ sidebar والتحكم، وتسميات واضحة (أو ربطها بـ label) لحقول البحث والفلترة؛ مراجعة تباين ألوان الحالات وإضافة رموز/نص حيث يلزم.
5. **تجربة تسجيل الدخول:** إخفاء كلمة المرور في بطاقات الحسابات التجريبية أو استبدالها بـ "••••••" مع زر "Use this account" وتوضيح أن البيئة تجريبية.

---

## 6. فحص تدفق مركز العمليات (إنشاء → التحقق → المراجعة → إكمال التنفيذ)

تم فحص التدفق التالي: **الدخول → مركز العمليات → إنشاء عملية (طلب سفر) → التحقق منها → مراجعتها (سير العمل) → إكمال التنفيذ حتى الإغلاق.** الجزء التفاعلي تم عبر المتصفح (التنقل وفتح وضع الإنشاء)، والتحقق من السلوك والواجهات عبر مراجعة الكود.

### 6.1 الخطوات المتوقعة في التطبيق

| # | الخطوة | الوصف في النظام |
|---|--------|------------------|
| 1 | الدخول | تسجيل الدخول (مثلاً admin@enterprise.local) — الصلاحيات تحدد ظهور "مركز العمليات" وزر "إنشاء طلب سفر". |
| 2 | فتح مركز العمليات | التنقل إلى `/en/operations` (أو `/ar/operations`). واجهة Master–Detail: جدول العمليات يسار، لوحة التفاصيل يمين. |
| 3 | إنشاء عملية | النقر على "Create Travel" أو فتح `/en/operations?mode=create&type=travel`. نموذج إنشاء طلب سفر من 4 خطوات (موظف، رحلة، ربط خدمات، ملخص). عند الإرسال يُنشأ طلب بحالة **draft**. |
| 4 | التحقق من العملية | اختيار الصف الجديد في الجدول → فتح لوحة التفاصيل. تبويبات: Overview، Workflow، Approval، Services، Audit. التحقق = التأكد من ظهور البيانات في Overview و Workflow. |
| 5 | مراجعة العملية | في تبويب **Workflow**: تنفيذ انتقالات سير العمل حسب الحالة والصلاحية: **Submit Request** (draft → submitted) ثم **Approve (Manager)** ثم **Start Travel Review** ثم **Approve (Finance)** ثم **Confirm Booking** ثم **Close Trip**. |
| 6 | إكمال التنفيذ | **Close Trip** (إغلاق الرحلة) ينتقل من `booked` إلى `closed`. شرط في المحرك: تاريخ العودة في الماضي + وجود حجز مسجّل + لا مصروفات معلقة + مزامنة مالية مكتملة. |

### 6.2 ما تم التحقق منه

- **المتصفح:** التنقل إلى `http://localhost:3000/en/operations?mode=create&type=travel` ناجح؛ الصفحة تعرض وضع الإنشاء (النموذج في اللوحة اليمنى). لم يُتح الحصول على عناصر DOM (refs) من أداة الـ snapshot، لذلك لم يُنفَّذ ملء الحقول والنقر على الأزرار آلياً.
- **مراجعة الكود:**
  - إنشاء الطلب: `TravelCreateForm` → `createTravelRequestApi` → طلب بحالة `draft`.
  - التحقق: `UnifiedDetailsPanel` يعرض Overview / Workflow / Approval / Services / Audit.
  - المراجعة: `UnifiedWorkflowPanel` + `transitionTravelRequest`؛ الصلاحيات من `mapEnterpriseRoleToTravelActorRole` (مثلاً admin = جميع الأدوار).
  - إكمال التنفيذ: `close_trip` في `travel-approval-engine` يتحقق من تاريخ العودة، وجود الحجز، المصروفات، والمزامنة المالية.

### 6.3 الأخطاء والمشاكل المسجّلة

| # | المشكلة | الموقع | الوصف |
|---|----------|--------|--------|
| 1 | **لا تغذية راجعة للمستخدم عند فشل إجراء سير العمل** | `unified-details-panel.tsx` → `handleTransition` | عند فشل `transitionTravelRequest` أو `transitionSalesOrder` يتم فقط `console.error`. المستخدم لا يرى رسالة خطأ في الواجهة ولا يعرف سبب الرفض (مثلاً policy_blocked، role_not_allowed، booking_not_recorded). |
| 2 | **استخدام `alert()` في نموذج إنشاء الطلب** | `travel-request-form.tsx` → `goNext()` | عند عدم إكمال خطوة الرحلة (step 2) يتم استدعاء `alert(t.notices.validationFailed)`. يختلف عن باقي التطبيق الذي يستخدم رسائل داخل الصفحة؛ تجربة غير متسقة ويصعب على قارئ الشاشة. |
| 3 | **عدم وضوح سبب منع "إغلاق الرحلة"** | `travel-approval-engine.ts` + الواجهة | منع انتقال `close_trip` يكون لأسباب متعددة: تاريخ العودة في المستقبل، عدم تسجيل الحجز، مصروفات معلقة، مزامنة مالية غير مكتملة. الواجهة تعرض "Blocked" / "غير مسموح" دون شرح السبب (`blockedReason` غير معروض للمستخدم). |
| 4 | **مكان تسجيل الحجز غير واضح في التدفق** | الواجهة | لإتمام "Confirm Booking" ثم "Close Trip" يجب تسجيل بيانات الحجز (vendor، bookingReference، إلخ). واجهة مركز العمليات لا توضّح أين أو كيف يُسجَّل الحجز بعد الموافقة المالية؛ قد يبحث المستخدم دون أن يجد نقطة الإدخال. |
| 5 | **رسالة خطأ إنشاء الطلب عامة** | `travel-create-form.tsx` | عند فشل إنشاء الطلب يُعرض `err.message` أو `t.notices.validationFailed`. إن رجع الـ API برسالة تقنية أو بلغة أخرى لا تتوافق مع لغة الواجهة تبقى التجربة غير واضحة. |
| 6 | **تبويب Workflow: عدم عرض الحالة التالية بعد التنفيذ** | سلوك متوقع | بعد النقر "Execute" يتم تحديث الطلب وتظهر الحالة الجديدة؛ لا يوجد مؤقتاً تأكيد بصري واضح (مثل toast) بأن الإجراء نجح، ما قد يربك المستخدم عند تنفيذ عدة انتقالات متتالية. |

### 6.4 توصيات خاصة بمركز العمليات

1. **عرض رسالة خطأ في الواجهة عند فشل انتقال سير العمل:** استدعاء `onRefresh` أو تمرير callback لعرض رسالة (toast / notice) مع نص الخطأ القادم من الـ API إن وُجد، أو ترجمة `blockedReason` (مثل policy_blocked، booking_not_recorded) لعرضها للمستخدم.
2. **استبدال `alert()` في نموذج طلب السفر:** استخدام نفس آلية الإشعار داخل الصفحة (مثل `notice` في `TravelCreateForm`) مع ربط الحقول التي لم تُكتمل أو عرض قائمة بالأخطاء.
3. **عرض سبب منع الانتقال في تبويب Workflow:** عند `allowed: false` عرض `blockedReason` مترجم (مثلاً "يجب تسجيل الحجز أولاً"، "تاريخ العودة لم يمر بعد") بدل الاكتفاء بـ "Blocked" / "غير مسموح".
4. **توضيح خطوة تسجيل الحجز:** في لوحة تفاصيل طلب السفر (أو تبويب مرتبط) إضافة قسم أو رابط واضح "تسجيل الحجز" يفتح نموذج إدخال vendor و bookingReference وتاريخ الحجز، مع ذكر ذلك في وصف تبويب Workflow عند الحالة `finance_approved` / `booked`.
5. **تأكيد بصري بعد تنفيذ انتقال:** إظهار رسالة نجاح قصيرة (مثل "تمت الموافقة" / "Transition applied") بعد كل تنفيذ ناجح لانتقال سير العمل.

### 6.5 تجربة إنشاء عمليات وتتبعها عبر المتصفح (أتمتة MCP)

تم تشغيل سيناريو اختبار عبر أداة **cursor-ide-browser** (MCP) لتتبع التدفق: تسجيل الدخول → مركز العمليات → إنشاء طلب سفر → العودة لمركز العمليات وفتح التفاصيل.

**ما تم تنفيذه بنجاح:**

- إدراج التبويب وقفله، التنقل إلى `/en/login` ثم إعادة التوجيه إلى `/en` (جلسة موجودة).
- التنقل إلى `/en/operations` و `/en/travel/create` والعودة إلى `/en/operations` — جميع المسارات تستجيب وتحمّل بدون أخطاء ظاهرة.

**ما لم يُنفَّذ آلياً (محدودية الأداة):**

- **لقطات الشاشة (snapshot):** الاستجابة كانت تحتوي على **metadata فقط** (viewId, title, url, locked) دون شجرة إمكانية وصول أو مراجع DOM. لذلك:
  - لم يُتح التحقق من ظهور قائمة العمليات أو رسالة "لا نتائج" في مركز العمليات.
  - لم يُتح الحصول على مراجع حقول نموذج إنشاء الطلب؛ **لم يُنفَّذ** ملء الحقول أو النقر على "التالي" / "إرسال".
  - لم يُتح النقر على صف في الجدول لفتح لوحة التفاصيل أو المودال، أو التحقق من ظهور الحالة بعد إنشاء طلب.

**توصيات للتحقق اليدوي:**

- **مركز العمليات:** التأكد من عرض القائمة (أو حالة "لا نتائج")، الفلاتر، وفتح لوحة التفاصيل عند النقر على صف.
- **إنشاء طلب سفر:** تنفيذ التدفق يدوياً (اختيار موظف/عميل، إكمال خطوات الرحلة والخدمات، الإرسال) والتحقق من التحقق من الصحة وإعادة التوجيه إلى `/operations?type=travel` عند النجاح.
- **بعد إنشاء طلب:** التأكد من ظهور الطلب الجديد في القائمة وفتح التفاصيل وعرض تبويب Workflow والانتقالات دون أخطاء في الواجهة أو الكونسول.

**خلاصة:** التنقل والـ lock/unlock يعملان كما هو متوقع. أي تحقق يعتمد على **محتوى الـ snapshot** (قائمة، نموذج، نقر على صف، نوافذ منبثقة) لم يُتح بسبب عدم إرجاع الأداة لمراجع العناصر. المشاكل الستة المسجّلة في 6.3 تبقى معتمدة على مراجعة الكود والاختبار اليدوي حتى تتوفر أداة تُرجع شجرة الوصول أو مراجع DOM.

---

## 7. الخلاصة

التطبيق يعطي انطباعاً منظماً واحترافياً من ناحية الهيكل والتنقل ودعم العربية و RTL. لأجل تجربة مستخدم قريبة من الأنظمة الاحترافية يُنصح بمعالجة: عناوين الصفحات، حالات التحميل والأخطاء، توحيد الترجمة، وإمكانية الوصول (بما فيها التسميات والتركيز). تنفيذ التوصيات أعلاه يرفع تقييم تجربة المستخدم ويقلل المشاكل التي قد يواجهها مجرب الأنظمة أو المستخدم النهائي.

**بعد فحص تدفق مركز العمليات:** يُضاف تحسين تغذية الراجعة عند فشل إجراءات سير العمل، ووضوح أسباب منع الانتقالات، وتوضيح خطوة تسجيل الحجز، واستبدال `alert()` في النماذج — لضمان تدفق إنشاء عملية → التحقق منها → مراجعتها → إكمال تنفيذها دون التباس أو صمت عند الأخطاء.
